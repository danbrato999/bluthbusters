<h2 mat-dialog-title>{{ isUpdate() ? 'Update data' : 'Add new movie' }}</h2>
<mat-dialog-content>
    <mat-vertical-stepper [linear]="!isUpdate()" #stepper>
        <mat-step [stepControl]="posterForm">
            <form [formGroup]="posterForm">
                <ng-template matStepLabel>Search movie</ng-template>
                <app-movie-data-autocomplete *ngIf="!isUpdate()" (movieSelected)="selectMovie($event)"
                    (reset)="resetForms()"></app-movie-data-autocomplete>
                <div class="external-data-form poster-form">
                    <img *ngIf="posterControl.value" [src]="posterControl.value">
                    <mat-form-field>
                        <input matInput placeholder="Poster" type="text" formControlName="poster" required>
                        <mat-error *ngIf="posterControl.hasError('required')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <div>
                        <button mat-raised-button color="primary" matStepperNext [disabled]="!posterForm.valid">Next</button>
                    </div>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="trailerForm">
            <form [formGroup]="trailerForm">
                <ng-template matStepLabel>Trailer</ng-template>
                <div class="external-data-form">
                    <div class="trailer-container" *ngIf="escapedTrailer">
                        <iframe [src]="escapedTrailer" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <app-trailer-autocomplete (trailerSelected)="selectTrailer($event)"
                        (reset)="trailerForm.reset()"></app-trailer-autocomplete>
                    <div>
                        <button mat-raised-button color="primary" matStepperNext [disabled]="!trailerForm.valid">Next</button>
                    </div>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="externalDataForm">
            <form [formGroup]="externalDataForm">
                <ng-template matStepLabel>Details</ng-template>
                <div class="external-data-form">
                    <mat-form-field>
                        <input matInput placeholder="imdbId" type="text" formControlName="imdbId" required>
                        <mat-error *ngIf="isDataMissingError('imdbId')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Title" type="text" formControlName="title" required>
                        <mat-error *ngIf="isDataMissingError('title')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Year" type="number" formControlName="year" required>
                        <mat-error *ngIf="yearControl.hasError('required')">
                            This field is required
                        </mat-error>
                        <mat-error *ngIf="yearControl.hasError('min') || yearControl.hasError('max')">
                            Must be a year between 1888 and now
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Director" type="text" formControlName="director" required>
                        <mat-error *ngIf="isDataMissingError('director')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Genre" type="text" formControlName="genre" required>
                        <mat-error *ngIf="isDataMissingError('genre')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Runtime" type="text" formControlName="runtime" required>
                        <mat-error *ngIf="isDataMissingError('runtime')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <textarea matInput placeholder="Description" type="text" formControlName="description" required></textarea>
                        <mat-error *ngIf="isDataMissingError('description')">
                            This field is required
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Copies" type="number" formControlName="copies" required>
                        <mat-error *ngIf="copiesControl.hasError('required')">
                            Numeric value required
                        </mat-error>
                        <mat-error *ngIf="copiesControl.hasError('min')">
                            Must be greater than 0
                        </mat-error>
                    </mat-form-field>
                </div>
            </form>
        </mat-step>
    </mat-vertical-stepper>
</mat-dialog-content>
<div mat-dialog-actions>
    <button mat-button (click)="closeDialog()">Cancel</button>
    <button mat-button [mat-dialog-close]="joinedMovieData()" [disabled]="!isMovieValid()">
        {{ isUpdate() ? 'Save' : 'Add' }}
    </button>
</div>
